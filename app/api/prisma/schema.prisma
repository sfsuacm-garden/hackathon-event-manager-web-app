generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider = "prisma-zod-generator"
  output   = "../src/zod"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum ApplicationStatus {
  pending
  rejected
  accepted
  waitlisted
}

enum TShirtSize {
  US_XS
  US_S
  US_M
  US_L
  US_XL
  US_XXL
  UK_6
  UK_8
  UK_10
  UK_12
  UK_14
  UK_16
}

model Application {
  id                        String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  eventId                   String?          @map("event_id") @db.Uuid
  userId                    String?          @map("user_id") @db.Uuid
  status                    String?          @default("pending")
  school                    String?
  graduationYear            Int?             @map("graduation_year")
  experienceLevel           String?          @map("experience_level")
  submissionDate             DateTime?       @map("submission_date")
  createdAt                 DateTime?        @default(now()) @map("created_at")
  publicStatus              ApplicationStatus? @map("public_status")
  internalStatus            ApplicationStatus? @map("internal_status")
  schoolId                  String?          @map("school_id") @db.Uuid
  dob                       String?
  phoneNumber               String?          @map("phone_number")
  levelOfStudy              String?          @map("level_of_study")
  countryOfResidence        String?          @map("country_of_residence")
  linkedinUrl               String?          @map("linkedin_url")
  mlhAuthorizedPromoEmail   Boolean?         @map("mlh_authorized_promo_email")
  mlhAuthorizedDataShare    Boolean?         @map("mlh_authorized_data_share")
  mlhCodeOfConductAgreement Boolean?         @map("mlh_code_of_conduct_aggreemeant")
  dietaryVegetarian          Boolean?        @map("dietary_vegetarian")
  dietaryVegan               Boolean?        @map("dietary_vegan")
  dietaryCeliacDisease       Boolean?        @map("dietary_celiac_disease")
  dietaryKosher              Boolean?        @map("dietary_kosher")
  dietaryHalal               Boolean?        @map("dietary_halal")
  gender                     String?
  pronouns                   String?
  raceEthnicity              String?         @map("race_ethnicity")
  sexualOrientation          String?         @map("sexual_orientation")
  educationLevel             String?         @map("education_level")
  tshirtSize                 TShirtSize?     @map("tshirt_size")
  majorFieldOfStudy          String?         @map("major_field_of_study")

  events                     Event?          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  profiles                   Profile?        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@map("applications")
}

model Event {
  id                     String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String
  description            String?
  startDate              DateTime?     @map("start_date") @db.Timestamp(6)
  endDate                DateTime?     @map("end_date") @db.Timestamp(6)
  createdAt              DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  isEventLive            Boolean?      @map("is_event_live")
  isTeamManagementOpen   Boolean?      @map("is_team_managment_open")

  applications           Application[]
  mailingLists           MailingList[]
  teams                  Team[]

  @@map("events")
}

model MailingListMember {
  mailingListId String       @map("mailing_list_id") @db.Uuid
  userId        String       @map("user_id") @db.Uuid
  mailingList   MailingList  @relation(fields: [mailingListId], references: [id], onDelete: Cascade)
  profiles      Profile      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([mailingListId, userId])
  @@map("mailing_list_members")
}

model MailingList {
  id             String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  eventId        String?              @map("event_id") @db.Uuid
  name           String
  createdAt      DateTime?            @default(now()) @map("created_at") @db.Timestamp(6)

  mailingListMembers MailingListMember[]
  events             Event?            @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("mailing_lists")
}

model Profile {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                String               @unique
  fullName             String               @map("full_name")
  role                 String
  createdAt            DateTime?            @default(now()) @map("created_at") @db.Timestamp(6)

  applications         Application[]
  mailingListMembers   MailingListMember[]
  teamMembers          TeamMember[]

  @@map("profiles")
}

model School {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  emailDomain  String   @map("email_domain")
  countryCode  String   @unique @map("country_code") @db.VarChar
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@map("schools")
}

model TeamMember {
  teamId   String   @map("team_id") @db.Uuid
  userId   String   @map("user_id") @db.Uuid
  isAdmin  Boolean? @map("is_admin")
  joinedAt DateTime? @map("joined_at") @db.Timestamp(6)

  teams    Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  profiles Profile  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([teamId, userId])
  @@map("team_members")
}

model Team {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  eventId      String?      @map("event_id") @db.Uuid
  name         String?
  createdAt    DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)

  teamMembers  TeamMember[]
  events       Event?       @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("teams")
}
